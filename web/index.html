<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tá»« Äiá»ƒn Trie Tree</title>
</head>
<body>
    <h2>ğŸš€ Tá»« Ä‘iá»ƒn Anh - Viá»‡t ğŸš€</h2>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Nháº­p tá»« cáº§n tÃ¬m..." oninput="getSuggestions()" autocomplete="off">
        <button onclick="searchWord()">TÃ¬m kiáº¿m</button>
        <ul id="suggestionsList"></ul>
    </div>

    <div id="result"></div>

    <div class="options">
        <div class="option">PhÃ¡t Ã¢m</div>
        <div class="option" onclick="startGuessGame()">TrÃ² chÆ¡i Ä‘oÃ¡n tá»«</div>
        <div class="option" onclick="startMatchGame()">TrÃ² chÆ¡i ghÃ©p tá»«</div>
    </div>

    <!-- Modal trÃ² chÆ¡i Ä‘oÃ¡n tá»« -->
    <div id="guessGameModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('guessGameModal')">&times;</span>
            <h2 style="color: black;">ğŸ•¹ï¸ TrÃ² chÆ¡i Ä‘oÃ¡n tá»«</h2>
            <p id="guessGameQuestion"></p>
            <input type="text" id="guessGameAnswer" placeholder="Nháº­p tá»« tiáº¿ng Anh...">
            <button onclick="submitGuessAnswer()">Tráº£ lá»i</button>
            <button onclick="closeModal('guessGameModal')">ÄÃ³ng</button>
            <div id="guessGameFeedback"></div>
            <button id="guessNextBtn" onclick="startGuessGame()" style="display: none;">Tiáº¿p tá»¥c</button>
        </div>
    </div>

    <!-- Modal trÃ² chÆ¡i ghÃ©p tá»« -->
    <div id="matchGameModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('matchGameModal')">&times;</span>
            <h2 style="color: black;">ğŸ•¹ï¸ TrÃ² chÆ¡i ghÃ©p tá»«</h2>
            <p id="matchGameQuestion"></p>
            <div id="lettersContainer"></div>
            <div id="answerContainer"></div>
            <button onclick="submitMatchAnswer()">Tráº£ lá»i</button>
            <button onclick="closeModal('matchGameModal')">ÄÃ³ng</button>
            <div id="matchGameFeedback"></div>
            <button id="matchNextBtn" onclick="startMatchGame()" style="display: none;">Tiáº¿p tá»¥c</button>
        </div>
    </div>

    <script>
        let correctGuessAnswer = "";
        let correctMatchAnswer = "";

        async function searchWord() {
            let word = document.getElementById("searchInput").value.trim();
            if (!word) {
                alert("Vui lÃ²ng nháº­p tá»« cáº§n tÃ¬m!");
                return;
            }
            let response = await fetch(`/search?word=${encodeURIComponent(word)}`);
            let data = await response.json();
            let resultDiv = document.getElementById("result");
            if (!data.exists) {
                resultDiv.innerHTML = `<p style="color:red;">âŒ ${data.message}</p>`;
            } else {
                resultDiv.innerHTML = `
                    <h3>Káº¿t quáº£ tÃ¬m kiáº¿m:</h3>
                    <p><b>Tá»«:</b> ${data.data.word}</p>
                    <p><b>PhiÃªn Ã¢m:</b> ${data.data.phonetic}</p>
                    <p><b>Loáº¡i tá»«:</b> ${data.data.types.join(", ")}</p>
                    <p><b>Äá»‹nh nghÄ©a:</b> ${data.data.meanings.join("; ")}</p>
                    <p><b>VÃ­ dá»¥:</b> ${data.data.examples.join("; ")}</p>
                `;
            }
        }
        

        async function startGuessGame() {
            let response = await fetch('/game-word');
            let data = await response.json();
            correctGuessAnswer = data.word.toLowerCase();
            document.getElementById("guessGameQuestion").innerHTML = `ğŸ”¹ NghÄ©a tiáº¿ng Viá»‡t: <b>${data.meaning}</b>`;
            document.getElementById("guessGameModal").style.display = "flex";
        }

        function submitGuessAnswer() {
            let userAnswer = document.getElementById("guessGameAnswer").value.trim().toLowerCase();
            let feedback = document.getElementById("guessGameFeedback");
            feedback.innerHTML = userAnswer === correctGuessAnswer ? "<span style='color: green;'>âœ… ChÃ­nh xÃ¡c!</span>" : `<span style='color: red;'>âŒ Sai! ÄÃ¡p Ã¡n Ä‘Ãºng lÃ : <b>${correctGuessAnswer}</b></span>`;
            document.getElementById("guessNextBtn").style.display = "block";
        }

        async function startMatchGame() {
            let response = await fetch('/game-word');
            let data = await response.json();
            correctMatchAnswer = data.word.toLowerCase();
            document.getElementById("matchGameQuestion").innerHTML = `ğŸ”¹ NghÄ©a tiáº¿ng Viá»‡t: <b>${data.meaning}</b>`;
            document.getElementById("lettersContainer").innerHTML = shuffle(correctMatchAnswer).split('').map(letter => `<button onclick="selectLetter(this)">${letter}</button>`).join('');
            document.getElementById("answerContainer").innerHTML = "";
            document.getElementById("matchGameModal").style.display = "flex";
        }

        async function getSuggestions() {
    let input = document.getElementById("searchInput").value.trim();
    let suggestionsList = document.getElementById("suggestionsList");

    if (input.length < 1) {
        suggestionsList.innerHTML = "";
        suggestionsList.style.display = "none"; // áº¨n danh sÃ¡ch khi khÃ´ng nháº­p Ä‘á»§ kÃ½ tá»±
        return;
    }

    try {
        let response = await fetch(`/autocomplete?prefix=${encodeURIComponent(input)}`);
        let data = await response.json();
        
        if (data.suggestions.length) {
            suggestionsList.innerHTML = data.suggestions
                .map(word => `<li onclick="selectSuggestion('${word}')">${word}</li>`)
                .join("");
            suggestionsList.style.display = "block"; // Hiá»‡n danh sÃ¡ch
        } else {
            suggestionsList.innerHTML = "<li>(KhÃ´ng cÃ³ gá»£i Ã½)</li>";
            suggestionsList.style.display = "block";
        }
    } catch (error) {
        console.error("âŒ Lá»—i gá»i API autocomplete:", error);
    }
}

function selectSuggestion(word) {
    document.getElementById("searchInput").value = word;
    document.getElementById("suggestionsList").innerHTML = "";
    document.getElementById("suggestionsList").style.display = "none"; // áº¨n danh sÃ¡ch sau khi chá»n
}


       

 


        function shuffle(word) {
            return word.split('').sort(() => Math.random() - 0.5).join('');
        }

        function selectLetter(button) {
            document.getElementById("answerContainer").innerHTML += button.innerHTML;
            button.disabled = true;
        }

        function submitMatchAnswer() {
            let userAnswer = document.getElementById("answerContainer").innerText.toLowerCase();
            let feedback = document.getElementById("matchGameFeedback");
            feedback.innerHTML = userAnswer === correctMatchAnswer ? "<span style='color: green;'>âœ… ChÃ­nh xÃ¡c!</span>" : `<span style='color: red;'>âŒ Sai! ÄÃ¡p Ã¡n Ä‘Ãºng lÃ : <b>${correctMatchAnswer}</b></span>`;
            document.getElementById("matchNextBtn").style.display = "block";
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }
    </script>
</body>
</html>







