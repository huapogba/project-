<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª´ ƒêi·ªÉn Trie Tree</title>
</head>
<body>

    <h2>üöÄ  T·ª´ ƒëi·ªÉn Anh - Vi·ªát  üöÄ</h2>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ c·∫ßn t√¨m..." oninput="getSuggestions()" autocomplete="off">
        <button onclick="searchWord()">T√¨m ki·∫øm</button>
        <ul id="suggestionsList"></ul>
    </div>

    <div id="result"></div>

    <div class="options">
        <div class="option">Ph√°t √¢m</div>
        <div class="option" onclick="startGame()">Gaming</div>
        <div id="gameModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeGameModal()">&times;</span>
                <h2 style="color: black;">üïπÔ∏è Tr√≤ ch∆°i ƒëo√°n t·ª´</h2>
                <p id="gameQuestion"></p>
                <input type="text" id="gameAnswer" placeholder="Nh·∫≠p t·ª´ ti·∫øng Anh..." />
                <button onclick="submitGameAnswer()" style="background: #007BFF; color: white;">Tr·∫£ l·ªùi</button>
                <button onclick="closeGameModal()" style="background: gray; color: white;">ƒê√≥ng</button>
                <div id="gameFeedback"></div> <!-- Th√™m ch·ªó hi·ªÉn th·ªã k·∫øt qu·∫£ -->
                <button id="nextWordBtn" onclick="nextWord()" style="display: none; background: green; color: white;">Ti·∫øp t·ª•c</button>
            </div>
        </div>
        
        <div class="option">Test</div>
    </div>

    <script>
        async function searchWord() {
            let word = document.getElementById("searchInput").value.trim();
            if (!word) {
                alert("Vui l√≤ng nh·∫≠p t·ª´ c·∫ßn t√¨m!");
                return;
            }

            try {
                let response = await fetch(`/search?word=${encodeURIComponent(word)}`);
                let data = await response.json();

                let resultDiv = document.getElementById("result");
                if (!data.exists) {
                    resultDiv.innerHTML = `<p style="color:red;">‚ùå ${data.message}</p>`;
                } else {
                    resultDiv.innerHTML = `
                        <h3>K·∫øt qu·∫£ t√¨m ki·∫øm:</h3>
                        <p><b>T·ª´:</b> ${data.data.word}</p>
                        <p><b>Phi√™n √¢m:</b> ${data.data.phonetic}</p>
                        <p><b>Lo·∫°i t·ª´:</b> ${data.data.types.join(", ")}</p>
                        <p><b>ƒê·ªãnh nghƒ©a:</b> ${data.data.meanings.join("; ")}</p>
                        <p><b>V√≠ d·ª•:</b> ${data.data.examples.join("; ")}</p>
                    `;
                }
            } catch (error) {
                console.error("L·ªói khi t√¨m ki·∫øm:", error);
            }
        }

        async function getSuggestions() {
            const prefix = document.getElementById("searchInput").value.trim();
            const suggestionsList = document.getElementById("suggestionsList");

            if (prefix.length === 0) {
                suggestionsList.style.display = "none";
                return;
            }

            const response = await fetch(`/autocomplete?prefix=${prefix}`);
            const data = await response.json();

            if (data.suggestions.length === 0) {
                suggestionsList.style.display = "none";
                return;
            }

            let listHTML = "";
            data.suggestions.forEach(word => {
                listHTML += `<li onclick="selectWord('${word}')">${word}</li>`;
            });

            suggestionsList.innerHTML = listHTML;
            suggestionsList.style.display = "block";
        }

        function selectWord(word) {
            document.getElementById("searchInput").value = word;
            document.getElementById("suggestionsList").style.display = "none";
        }
        let correctAnswer = ""; // Bi·∫øn l∆∞u tr·ªØ ƒë√°p √°n ƒë√∫ng

// Hi·ªÉn th·ªã modal tr√≤ ch∆°i
async function startGame() {
    try {
        let response = await fetch('/game-word');
        let data = await response.json();

        if (!data.word || !data.meaning) {
            alert("L·ªói l·∫•y d·ªØ li·ªáu tr√≤ ch∆°i!");
            return;
        }

        correctAnswer = data.word.toLowerCase(); // C·∫≠p nh·∫≠t ƒë√°p √°n m·ªõi
        document.getElementById("gameQuestion").innerHTML = `üîπ Nghƒ©a ti·∫øng Vi·ªát: <b>${data.meaning}</b>`;
        document.getElementById("gameAnswer").value = ""; // X√≥a c√¢u tr·∫£ l·ªùi c≈©
        document.getElementById("gameFeedback").innerHTML = ""; // X√≥a ph·∫£n h·ªìi c≈©
        document.getElementById("nextWordBtn").style.display = "none"; // ·∫®n n√∫t ti·∫øp t·ª•c ban ƒë·∫ßu

        document.getElementById("gameModal").style.display = "flex"; // Hi·ªÉn th·ªã modal tr√≤ ch∆°i
    } catch (error) {
        console.error("L·ªói khi t·∫£i tr√≤ ch∆°i:", error);
    }
}


// Ki·ªÉm tra ƒë√°p √°n
function submitGameAnswer() {
    const userAnswer = document.getElementById("gameAnswer").value.trim().toLowerCase();
    const feedback = document.getElementById("gameFeedback");
    const nextWordBtn = document.getElementById("nextWordBtn");

    if (userAnswer === correctAnswer) {
        feedback.innerHTML = "<span style='color: green;'>‚úÖ Ch√≠nh x√°c!</span>";
    } else {
        feedback.innerHTML = `<span style='color: red;'>‚ùå Sai! ƒê√°p √°n ƒë√∫ng l√†: <b>${correctAnswer}</b></span>`;
    }

    nextWordBtn.style.display = "block"; // Lu√¥n hi·ªÉn th·ªã n√∫t "Ti·∫øp t·ª•c"
}




// H√†m nextword ƒë·ªÉ g·ªçi API v√† l·∫•y t·ª´ m·ªõi
async function nextWord() {
    try {
        let response = await fetch('/game-word');
        let data = await response.json();

        if (!data.word || !data.meaning) {
            alert("L·ªói l·∫•y d·ªØ li·ªáu tr√≤ ch∆°i!");
            return;
        }

        correctAnswer = data.word.toLowerCase(); // C·∫≠p nh·∫≠t ƒë√°p √°n m·ªõi
        document.getElementById("gameQuestion").innerHTML = `üîπ Nghƒ©a ti·∫øng Vi·ªát: <b>${data.meaning}</b>`;
        document.getElementById("gameAnswer").value = ""; // X√≥a c√¢u tr·∫£ l·ªùi c≈©
        document.getElementById("gameFeedback").innerHTML = ""; // X√≥a ph·∫£n h·ªìi c≈©
        document.getElementById("nextWordBtn").style.display = "none"; // ·∫®n n√∫t ti·∫øp t·ª•c cho l·∫ßn sau
    } catch (error) {
        console.error("L·ªói khi t·∫£i t·ª´ m·ªõi:", error);
    }
}

// Th√™m s·ª± ki·ªán cho n√∫t "Ti·∫øp t·ª•c"
document.getElementById("nextWordBtn").addEventListener("click", nextWord);

// L·∫Øng nghe s·ª± ki·ªán khi ng∆∞·ªùi ch∆°i nh·∫•n n√∫t "Ti·∫øp t·ª•c"
document.getElementById('nextButton').addEventListener('click', nextword);


// ƒê√≥ng modal
function closeGameModal() {
    document.getElementById("gameModal").style.display = "none";
    document.getElementById("gameAnswer").value = ""; // X√≥a n·ªôi dung nh·∫≠p
    document.getElementById("gameFeedback").innerHTML = ""; // X√≥a ph·∫£n h·ªìi
    document.getElementById("nextWordBtn").style.display = "none"; // ·∫®n n√∫t ti·∫øp t·ª•c
}


        document.querySelector(".option:nth-child(2)").addEventListener("click", startGame);

        document.addEventListener("click", function(event) {
            if (!event.target.matches("#searchInput") && !event.target.matches("#suggestionsList li")) {
                document.getElementById("suggestionsList").style.display = "none";
            }
        });
    </script>

</body>
</html>




